# 人物管理機能仕様書

## 概要

画像から識別された顔に対して人物情報を登録・編集・検索・マージする機能です。

## 機能要件

### 1. 人物の新規登録

#### 1.1 基本フロー
1. 画像上の顔領域をクリック
2. 「新規人物として登録」を選択
3. 人物情報入力ダイアログが表示
4. 必要情報を入力して保存

#### 1.2 登録可能な情報
- **基本情報**
  - 名前（必須）
  - 会社・所属
  - メモ
  
- **個人情報**
  - 趣味
  - 誕生日
  - 初対面の日付
  - 初対面の文脈

### 2. 人物情報の編集

#### 2.1 編集ダイアログ
- 人物カードをクリックで編集ダイアログを表示
- すべての登録情報を編集可能
- 顔写真の変更（複数の写真から選択）

### 3. 人物の検索・フィルタリング

#### 3.1 検索機能
- 名前による部分一致検索
- 会社名による絞り込み
- タグによるフィルタリング

#### 3.2 並び替え
- 名前順（あいうえお順）
- 登録日時順
- 更新日時順

### 4. 人物のマージ（統合）

#### 4.1 マージの必要性
- 同一人物が複数登録された場合
- 異なる写真から同じ人物を識別した場合

#### 4.2 マージフロー
1. マージしたい人物を複数選択
2. 「人物を統合」ボタンをクリック
3. 統合先の人物を選択
4. 情報の統合方法を選択
5. 確認して実行

#### 4.3 AI支援マージ提案（将来実装）
- 顔認識による類似度判定
- 名前の類似性チェック
- 自動マージ提案

## UI仕様

### 人物カード
```
┌─────────────────┐
│   [顔写真]      │
│                 │
│ 山田 太郎       │
│ 株式会社ABC     │
│                 │
│ 👥2 👔1        │
└─────────────────┘
```

### 人物編集ダイアログ
```
┌─────────────────────────────────────────────┐
│  人物情報を編集                             │
│                                             │
│  顔写真: [写真1] [写真2] [+追加]            │
│                                             │
│  基本情報                                   │
│  名前*: [山田 太郎        ]                 │
│  会社:  [株式会社ABC      ]                 │
│  メモ:  [営業部長         ]                 │
│                                             │
│  個人情報                                   │
│  趣味:     [ゴルフ、読書   ]                │
│  誕生日:   [1980-04-15    ]                 │
│  初対面:   [2024-01-15    ]                 │
│  初対面の文脈: [新年会で紹介]               │
│                                             │
│  関連する人物                               │
│  ・田中 一郎（同僚）                        │
│  ・佐藤 花子（部下）                        │
│                                             │
│         [削除]    [キャンセル]  [保存]      │
└─────────────────────────────────────────────┘
```

## データ仕様

[データモデル設計書](../../architecture/data-model.md)の`people`コレクションを参照

## エラーハンドリング

### バリデーション
- 名前は必須入力
- 誕生日は未来日付不可
- 初対面日付は未来日付不可

### 削除時の確認
- 関連する接続情報も削除される旨を警告
- 削除は取り消し不可であることを明示

## パフォーマンス考慮

- 人物リストは仮想スクロールで表示
- 画像は遅延読み込み
- 検索は debounce 処理（300ms） 