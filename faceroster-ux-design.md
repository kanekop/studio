# FaceRoster 関係性作成機能 UXデザイン仕様書

## 概要

FaceRosterアプリケーションにおける人物間の関係性（コネクション）作成機能のUXを、より直感的で柔軟なものに改善するための設計仕様書です。双方向の関係（友人、同僚）と単方向の関係（親子、上司部下）の両方を、明確かつ使いやすい形で扱えるようにします。

## 現状の課題分析

（初期のドラッグ&ドロップ方式に関する課題。現在は改善済み）
- ~~関係の方向性が暗黙的~~
- ~~関係タイプの区別が困難~~
- モバイルでの操作性：ドラッグ&ドロップがタッチデバイスで困難（コンテキストメニューで一部対応検討）
- ~~既存関係の可視性~~ (人物カードへのバッジ表示で一部対応)

## 提案する新しいUXデザイン

### 1. ハイブリッド接続方式

ドラッグ&ドロップを基本としつつ、関係性の性質に応じた視覚的フィードバックを提供します。

#### ドラッグ中の視覚的ガイド

```
【ドラッグ開始時】
- ドラッグ元のカードが軽くハイライト (実装済み: opacity, scale)
- (高度) ドラッグ元のカードから矢印が伸びる (未実装)
- (高度) 矢印の先端がマウスカーソルを追従 (未実装)


【ホバー時】
- ドロップ可能なカードが緑色にハイライト (実装済み: ring, border, bg-color)
- (高度) 関係性のプレビューが表示される (例：「田中太郎 → 山田花子」) (未実装)
- (高度) 既存の関係がある場合は警告アイコン表示 (未実装)
```

### 2. スマートな関係性提案システム（関係性作成ダイアログの改善）

ドロップ時のダイアログを、関係性のタイプに応じて知的に提案します。
（現在の実装は `connection-dialog-improvements.md` の提案を優先しています）

#### 関係性作成ダイアログ（改善版 - `connection-dialog-improvements.md` に基づく）

```
┌─────────────────────────────────────────────┐
│  関係性を作成                               │
│                                             │
│  👤 ソース人物名  ──→  👤 ターゲット人物名   │
│  (あなたが定義する関係: ソースからターゲットへ) │
│                                             │
│ ─────────────────────────────────────────── │
│                                             │
│ 📌 関係性カテゴリ                           │
│                                             │
│  ┌─ Common (青系背景/枠) ───────────────┐   │
│  │ 🏢 Colleague  👥 Friend             │   │
│  │ 🤝 Acquaintance 🎯 Club Member      │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  ┌─ Hierarchical (オレンジ系背景/枠) ────┐   │
│  │ (ソースからターゲットへの役割)           │
│  │ 👨‍👦 Parent   👶 Child                 │   │
│  │ 👔 Manager  📋 Reports to            │   │
│  │ 🎓 Mentor   📚 Mentee                │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  ┌─ Special (ピンク系背景/枠) ───────────┐   │
│  │ 💏 Spouse   💕 Partner              │   │
│  │ 👨‍👩‍👧 Family Member (other)          │   │
│  └─────────────────────────────────────┘   │
│  * 相互排他的な関係は自動的に調整されます。  │
│                                             │
│ ─────────────────────────────────────────── │
│                                             │
│ 🏷️ カスタム関係                            │
│ ┌─────────────────────────────────────┐   │
│ │ その他の関係を入力 (カンマ区切り)...  │   │
│ └─────────────────────────────────────┘   │
│                                             │
│ 📝 詳細情報（任意）                         │
│ ┌─────────────────────────────────────┐   │
│ │ 関係の理由： (改行またはカンマ区切り) │   │
│ │ 例：2020年のプロジェクトで知り合った│   │
│ └─────────────────────────────────────┘   │
│                                             │
│ 💪 関係の強さ：[●●●○○] 3/5 (スライダー)    │
│                                             │
│ ┌─────────────────────────────────────┐   │
│ │ メモ：                              │   │
│ │                                     │   │
│ └─────────────────────────────────────┘   │
│                                             │
│         [キャンセル]  [保存]                │
└─────────────────────────────────────────────┘
```
*   **論理的整合性チェック**: 相互に排他的な関係タイプ（例：親子、上司部下）が選択された場合、他方を自動的に解除するロジックを導入。（実装済み）

### 3. 関係性の可視化改善

#### 人物カードのデザイン改善

人物カードに既存の関係性を示すバッジを表示します。（実装済み）

```
┌─────────────────────┐
│   👤 田中太郎       │
│                     │
│   🏢 Acme Corp      │
│   🎂 1985/03/15     │
│                     │
│ ┌───┬───┬───┬───┐ │
│ │👥2│👨‍👩‍👧‍👦1│👔1│💑1│ │  <- アイコンは更新されたものを使用
│ └───┴───┴───┴───┘ │
└─────────────────────┘

バッジの意味（例）：
👥 (Users) - 一般的な関係が2つ
👨‍👩‍👧‍👦 (Home/Users2) - 家族関係が1つ
👔 (Award/ClipboardUser) - 職務上の階層関係が1つ
💑 (Heart/Gem) - 特別なパートナー関係が1つ
```

#### ホバー時の関係性プレビュー (未実装)

カードにホバーすると、その人物の関係性を簡潔に表示：

```
┌─────────────────────────┐
│ 田中太郎の関係性        │
├─────────────────────────┤
│ 👥 山田花子（同僚）     │
│ 👥 佐藤次郎（友人）     │
│ 👨‍👦 田中小太郎（息子）   │
│ 👔 鈴木部長（上司）     │
│ 💑 田中良子（配偶者）   │
│                         │
│ [すべて表示...]         │
└─────────────────────────┘
```

### 4. コンテキストメニューによる代替操作 (未実装)

モバイルデバイスやアクセシビリティを考慮した操作方法を提供します。

#### 長押し/右クリックメニュー

```
┌──────────────────────┐
│ 田中太郎             │
├──────────────────────┤
│ ⚡ クイック接続      │
│ 🔗 関係を作成        │
│ 👁️ 関係を表示        │
│ ✏️ 情報を編集        │
│ 🗑️ 削除             │
└──────────────────────┘
```

#### クイック接続モード

```
【Step 1: 対象を選択】
"クイック接続"選択後、接続したい人物をタップ

【Step 2: 関係タイプを選択】
ポップアップから関係タイプを選択して完了
```

### 5. 関係性作成の新フロー

#### フロー1: ドラッグ&ドロップ（デスクトップ向け） (実装済み)

1. **ドラッグ開始**：視覚的フィードバック表示
2. **ドロップ**：関係性作成ダイアログ表示
3. **関係選択**：タイプ別に整理された選択肢から選択
4. **詳細入力**：必要に応じて詳細情報を入力
5. **保存**：Firestoreに保存

#### フロー2: タップ操作（モバイル向け） (未実装)

1. **選択モード起動**：「関係を作成」ボタンをタップ
2. **2人を選択**：関係を作りたい2人をタップで選択
3. **関係選択**：簡易ダイアログから関係タイプを選択
4. **完了**：即座に保存（詳細は後から編集可能）

### 6. 視覚的な関係性マップビュー (未実装)

人物一覧に加えて、関係性を俯瞰できるネットワークビューを提供します。

#### ネットワークビューの特徴

```
【表示モード切り替え】
┌─────┬─────┬─────┐
│ 📋  │ 🕸️  │ 🌳  │
│一覧 │ﾈｯﾄ │階層 │
└─────┴─────┴─────┘

【ネットワークビュー例】
        👤 自分
       /   |   \
    👥    👔    👨‍👩‍👦
   同僚  上司   家族
    |     |      |
   田中  鈴木   妻・子

【フィルター機能】
□ 友人関係
□ 仕事関係
□ 家族関係
□ その他
```

### 7. スマートな重複防止とエラーハンドリング (一部未実装)

#### 既存関係の検出と処理 (未実装 - 現在は単純に追加)

```
┌─────────────────────────────────────┐
│ ⚠️ 既存の関係があります             │
│                                     │
│ 現在の関係：                        │
│ • 田中太郎 → 山田花子（上司）       │
│                                     │
│ どうしますか？                      │
│                                     │
│ ○ 新しい関係を追加する             │
│   （複数の関係を持つことができます）│
│                                     │
│ ○ 既存の関係を更新する             │
│   （現在の関係を置き換えます）      │
│                                     │
│ ○ キャンセル                       │
│                                     │
│        [戻る]  [続ける]             │
└─────────────────────────────────────┘
```

#### 循環関係の警告 (未実装)

```
┌─────────────────────────────────────┐
│ ⚠️ 循環関係の可能性                 │
│                                     │
│ 山田さんは既に田中さんの上司です。  │
│ 田中さんを山田さんの上司に設定する  │
│ と、循環関係が発生します。          │
│                                     │
│ □ それでも続ける                   │
│                                     │
│        [キャンセル]  [OK]           │
└─────────────────────────────────────┘
```

## 実装の優先順位

### Phase 1: 基本機能の改善（完了済み - `connection-dialog-improvements.md` に基づく）
- 関係タイプの分類とデータモデル更新 (`connections`コレクション)
- 改善されたダイアログUIの実装（カテゴリ別選択、アイコン、カスタム入力、詳細情報入力）
- 基本的な視覚フィードバック（ドラッグ元・ドロップ先のハイライト）
- 論理的整合性チェック（相互排他関係の自動解除）

### Phase 2: 視覚的改善（一部完了済み）
- 人物カードへのバッジ表示（実装済み）
- ドラッグ&ドロップの視覚的フィードバック（実装済み）
- ホバー時の関係性プレビュー（未実装）

### Phase 3: モバイル対応（未実装）
- タップベースの関係作成フロー
- コンテキストメニューの実装
- レスポンシブデザインの調整

### Phase 4: 高度な機能（未実装）
- ネットワークビューの実装
- 高度なフィルタリング機能
- 関係性の分析機能
- 既存関係の検出・更新UI

## 技術的考慮事項

### パフォーマンス
- 大量の関係性データを扱う際の最適化
- 遅延読み込みとページネーション
- キャッシング戦略

### アクセシビリティ
- キーボード操作のサポート
- スクリーンリーダー対応
- 高コントラストモード

### 国際化
- 関係タイプの多言語対応
- 文化的な違いへの配慮（家族構成など）

## まとめ

この新しいUXデザインにより、FaceRosterは複雑な人間関係を直感的かつ正確に記録できるツールとなります。ドラッグ&ドロップの使いやすさを保ちながら、関係の方向性や種類を明確に表現でき、モバイルデバイスでも快適に使用できるようになることを目指します。
（`connection-dialog-improvements.md` の提案を取り込み、より洗練されたダイアログUIが実現されました。）
```